<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoloMeal Master ëƒ‰ì¥ê³  ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        // ë¡œê·¸ì¸ í™”ë©´ê³¼ ìœ ì‚¬í•œ ì•„ì´ë³´ë¦¬ í†¤ (ë©”ì¸ ë°°ê²½)
                        'bg-ivory': '#fffbf0',
                        // ë©”ë‰´ ì°½ ìƒ‰ìƒ: ë©”ì¸ ë°°ê²½ë³´ë‹¤ ì•½ê°„ ì§„í•œ ì•„ì´ë³´ë¦¬
                        'bg-soft-ivory': '#fcf7e7',
                        // ê¸°ì¡´ ë¡œê·¸ì¸ í™”ë©´ í†¤ì„ ì°¸ê³ í•œ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
                        'primary-green': '#8ac926',
                        'light-green': '#a9d682',
                        'soft-orange': '#ffb067',
                        'soft-yellow': '#fff3b0',
                        'soft-purple': '#a29bfe',

                    }
                }
            }
        }
    </script>
    <style>
        /* â­ï¸ í†µí•©ëœ í°íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° (ê¸°ì¡´) â­ï¸ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            /* â­ï¸ ë°°ê²½ìƒ‰ ë³€ê²½: í™ˆ.txtì˜ ë°°ê²½ìƒ‰ìœ¼ë¡œ ë³€ê²½ â­ï¸ */
            font-family: 'Inter', sans-serif;
            background-color: theme('colors.bg-ivory'); /* #fffbf0 */
            margin: 0;
            height: 100vh;
            overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        
        /* â¬‡ï¸ í•µì‹¬ ìˆ˜ì •: ëƒ‰ì¥ê³  ì•±ì„ ì´ˆê¸° ìˆ¨ê¹€ ì²˜ë¦¬ */
        #refrigerator-app {
            display: none; 
            height: 100vh;
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
            
            /* â­ï¸ í™ˆ.txtì˜ .mobile-container ìŠ¤íƒ€ì¼ ì ìš© â­ï¸ */
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            min-height: 100vh;
            background-color: theme('colors.bg-ivory'); /* ì•„ì´ë³´ë¦¬ ë°°ê²½ */
            position: relative;
        }

        #login-section {
            /* â­ï¸ ë°°ê²½ ì´ë¯¸ì§€ ê²½ë¡œ: static í´ë” ì•ˆì— honbab_master.pngë¥¼ ë„£ì–´ì•¼ í•©ë‹ˆë‹¤. â­ï¸ */
            background-image: url("í˜¼ë°¥_ë§ˆìŠ¤í„°.png"); 
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover; 
            min-height: 100vh;
            height: 100vh; 
            background-attachment: fixed;
            
            /* ë¡œê·¸ì¸ ë¸”ë¡ì„ ì¤‘ì•™ í•˜ë‹¨ì— ë°°ì¹˜ */
            display: flex;          
            justify-content: center; 
            align-items: flex-end;   
        }
        .login-box {
            background:  rgba(255, 255, 255, 0.9);
            padding: 24px;
            border-radius: 16px;
            /* border: 2px solid #f8e1ba; */
            width: 90%; 
            max-width: 280px; 
            margin-bottom: 60px; 
            text-align: center;
        }
        .login-box input {
            width: 100%;
            margin-bottom: 5px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        /* â­ï¸ ê¸°ì¡´ ìƒ‰ìƒ ë³€ê²½: primary-green ì‚¬ìš© â­ï¸ */
        .login-box button {
            width: 100%;
            padding: 10px;
            background-color: #5BA449;

            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        /* â­ï¸ ê¸°ì¡´ ìƒ‰ìƒ ë³€ê²½: light-green ì‚¬ìš© â­ï¸ */
        .login-box button:hover {
            background-color:  #a9d682 ;
        }

        #bottom-nav {
            display: none; 
        }

        /* ... (ë‚˜ë¨¸ì§€ ê¸°ì¡´ CSS ìŠ¤íƒ€ì¼ ìœ ì§€) ... */
        .message-box {
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-weight: 600;
        }
        .status-error {
            background-color: #fee2e2;
            color: #ef4444;
        }
        .status-success {
            background-color: #d1fae5;
            color: #10b981;
        }
        .status-info {
            background-color: #dbeafe;
            color: #3b82f6;
        }
        .inventory-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-top: 1rem;
        }
        /* â­ï¸ ê·¸ë£¹ í—¤ë” ìŠ¤íƒ€ì¼ (ê¸°ì¡´) */
        .category-header {
            border-bottom: 1px solid #e5e7eb;
            user-select: none;
            transition: background-color 0.2s;
        }
        .category-header:hover {
            background-color: #f3f4f6;
        }
        /* â­ï¸ ì•„ì´ì½˜ íšŒì „ ì• ë‹ˆë©”ì´ì…˜ (ê¸°ì¡´) */
        .toggle-icon {
            transition: transform 0.3s ease;
        }
        .rotate-90 {
            transform: rotate(90deg);
        }
        /* ì¬ê³  í•­ëª© ìŠ¤íƒ€ì¼ (ê¸°ì¡´) */
        .inventory-item {
            padding: 1rem;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
            cursor: pointer; 
        }
        .inventory-item:last-child {
            border-bottom: none;
        }
        .inventory-item:hover {
            background-color: #f9fafb;
        }
        .inventory-item:active {
            background-color: #eff6ff; 
        }
        .expiry-soon {
            background-color: #fffbeb; 
            border-left: 4px solid #f59e0b;
        }
        .expired {
            background-color: #fee2e2; 
            border-left: 4px solid #ef4444;
            opacity: 0.7;
        }
        /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ ë° ë§ì¤„ì„ ì²˜ë¦¬ (ë ˆì‹œí”¼ íƒ€ì´í‹€ìš©) */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-clamp: 2; 
            overflow: hidden;
            text-overflow: ellipsis;
            height: 2.5rem; 
        }
        /* â­ï¸ í™ˆ.txt ì˜ ë ˆì‹œí”¼ ì¹´ë“œ ì´ë¯¸ì§€ Placeholder ìŠ¤íƒ€ì¼ ì¶”ê°€ (ë ˆì‹œí”¼ ì¶”ì²œ ì„¹ì…˜ì— í•„ìš”) â­ï¸ */
        .recipe-image-placeholder {
            width: 100%;
            padding-top: 75%; /* 4:3 ë¹„ìœ¨ */
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #666;
            border-radius: 0.5rem;
            position: relative;
        }

        .scrollbar-hide {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }
    </style>
</head>
<body>
    <section id="login-section">
        <div class="login-box">
            <h2 class="text-xl font-bold text-green-700 mb-3" id="auth-title">í˜¼ë°¥ ë§ˆìŠ¤í„° ë¡œê·¸ì¸</h2> 
            <input type="text" id="login-id" placeholder="ì•„ì´ë””">
            <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" style="margin-bottom: 13px">
            <input type="text" id="register-full-name" placeholder="ì„±ëª…" class="hidden"> 
            <input type="password" id="register-pw-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" class="hidden"> 
            
            <button id="login-btn">ë¡œê·¸ì¸</button>
            <div class="mt-2 text-sm text-gray-600">
                <a href="#" class="hover:underline" id="toggle-register-btn">íšŒì›ê°€ì…</a> | 
                <a href="#" class="hover:underline">ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
            </div>
        </div>
    </section>

    <div id="refrigerator-app" class="shadow-xl"> 
        
        <header class="flex justify-between items-center p-4 bg-bg-ivory border-b border-gray-200 sticky top-0 z-20">
            <h1 class="text-3xl font-extrabold text-primary-green tracking-tight">SoloMeal Master</h1>
            
            <button id="menu-trigger" class="text-gray-700 hover:text-primary-green p-2 rounded-xl transition duration-150 active:bg-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            
        </header>

        <div id="menu-popup" class="absolute right-4 top-[5.5rem] w-48 bg-bg-soft-ivory rounded-xl shadow-2xl border border-gray-200 hidden z-30 overflow-hidden">
            <nav class="flex flex-col p-2 space-y-1">
                <button id="menu-refrigerator" class="w-full text-left px-4 py-3 text-lg text-gray-700 font-semibold hover:bg-light-green/20 rounded-lg transition duration-150">
                    <i class="fas fa-box mr-2"></i> ì œí’ˆ ë“±ë¡ ìš”ì²­
                </button>
                <button id="menu-settings" class="w-full text-left px-4 py-3 text-lg text-gray-700 font-semibold hover:bg-light-green/20 rounded-lg transition duration-150 border-t mt-2 pt-2">
                    <i class="fas fa-cog mr-2"></i> ì•Œë¦¼ ë³´ê¸°
                </button>
                <button id="menu-logout" class="w-full text-left px-4 py-3 text-lg text-red-500 font-semibold hover:bg-red-50/20 rounded-lg transition duration-150">
                    <i class="fas fa-sign-out-alt mr-2"></i> ë¡œê·¸ì•„ì›ƒ
                </button>
            </nav>
        </div>
        
        <div class="p-5"> 
            
            <div id="register-section" class="bg-bg-soft-ivory p-6 rounded-xl shadow-lg mb-8">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">ìƒí’ˆ ë“±ë¡</h2>
                
                <div class="flex space-x-2 mb-4">
                    <input type="text" id="barcode-input" placeholder="PLU/ë°”ì½”ë“œ ë²ˆí˜¸ ì…ë ¥" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-primary-green focus:border-primary-green transition duration-150">
                    <button id="search-button" class="bg-primary-green hover:bg-light-green text-white font-medium p-3 rounded-lg shadow-md transition duration-200">
                        <i class="fas fa-search"></i>
                    </button>
                    <button id="camera-trigger" class="bg-soft-orange hover:bg-soft-orange/80 text-white font-medium p-3 rounded-lg shadow-md transition duration-200" title="ë°”ì½”ë“œ ìŠ¤ìº”">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
                <input type="file" id="camera-input" accept="image/*" capture="environment" class="hidden">


                <div id="product-info-box" class="mt-4 p-4 border border-light-green/50 rounded-lg bg-light-green/10 hidden">
                    <p><strong class="text-primary-green">ìƒí’ˆëª…:</strong> <span id="display-product-name"></span></p>
                    <p><strong class="text-primary-green">ëŒ€ë¶„ë¥˜:</strong> <span id="display-major-category"></span></p>
                </div>

                <div class="mt-4">
                    <label for="expiry-date-input" class="block text-gray-700 font-medium mb-2">ìœ í†µê¸°í•œ</label>
                    <input type="date" id="expiry-date-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-green focus:border-primary-green transition duration-150">
                </div>

                <button id="register-button" class="w-full mt-4 bg-soft-purple hover:bg-soft-purple/80 text-white font-bold p-3 rounded-lg shadow-lg transition duration-200 disabled:opacity-50" disabled>
                    ëƒ‰ì¥ê³ ì— ë“±ë¡í•˜ê¸°
                </button>
            </div>

            <div id="status-message" class="message-box status-info text-sm hidden"></div>


            <div class="mt-6 w-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-700">ë‚˜ì˜ ëƒ‰ì¥ê³  ì¬ê³  (<span id="inventory-count">0</span>)</h2>
                    <button id="load-inventory-button" class="bg-soft-orange hover:bg-soft-orange/80 text-white font-medium px-4 py-2 rounded-lg shadow-md transition duration-200">
                        ë‚˜ì˜ ëƒ‰ì¥ê³  ì¡°íšŒ
                    </button>
                </div>
                
                <div id="inventory-list-container" class="inventory-list">
                    <p id="no-inventory-message" class="p-4 text-gray-500 text-center">ì¡°íšŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¬ê³  ëª©ë¡ì„ ê°€ì ¸ì˜¤ì„¸ìš”.</p>
                    </div>
            </div>

            <div class="mt-8 w-full">
                <h2 class="text-xl font-semibold text-gray-700 mb-4 flex justify-between items-center">
                    ë ˆì‹œí”¼ ì¶”ì²œ <span class="text-sm font-normal text-primary-green">(ì¬ê³  í•­ëª©ì„ í´ë¦­í•˜ì„¸ìš”!)</span>
                </h2>
                
                <div id="recipe-recommendations" class="grid grid-cols-2 gap-4">
                    <p id="no-recipe-message" class="col-span-2 p-4 text-gray-500 text-center">ì¬ê³  ëª©ë¡ì—ì„œ í•­ëª©ì„ í´ë¦­í•˜ë©´ ê´€ë ¨ ë ˆì‹œí”¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
            </div>
        </div>
        
    </div>

    <footer id="bottom-nav" class="fixed bottom-0 left-0 right-0 max-w-[600px] mx-auto 
                                    bg-white/95 backdrop-blur-sm shadow-2xl z-40 
                                    border-t border-gray-200 p-2 flex justify-around items-center">
            
            <button id="nav-refrigerator" class="flex flex-col items-center text-primary-green transition duration-150 p-2 rounded-lg active:bg-gray-100">
                <!-- <i class="fas fa-box text-xl"></i> -->
                <img src="/static/cart.png" alt="ì¬ê³  ì•„ì´ì½˜" class="w-7 h-7">
                <span class="text-xs mt-1 font-semibold">ë‚˜ì˜ ëƒ‰ì¥ê³ </span>
            </button>
            
            <button id="nav-recipes" class="flex flex-col items-center text-gray-500 hover:text-primary-green transition duration-150 p-2 rounded-lg active:bg-gray-100">
                <!-- <i class="fas fa-utensils text-xl"></i> -->
                <img src="/static/home.png" alt="í™ˆ ì•„ì´ì½˜" class="w-7 h-7">
                <span class="text-xs mt-1 font-semibold">í™ˆ</span>
            </button>

            <button id="nav-settings" class="flex flex-col items-center text-gray-500 hover:text-primary-green transition duration-150 p-2 rounded-lg active:bg-gray-100">
                <!-- <i class="fas fa-cog text-xl"></i> -->
                <img src="/static/my.png" alt="ë§ˆì´í˜ì´ì§€" class="w-7 h-7">
                <span class="text-xs mt-1 font-semibold">ë§ˆì´í˜ì´ì§€</span>
            </button>
            
        </footer>

    <script>
        const BASE_URL = window.location.origin;

        // â­ï¸ ì¶”ê°€: ë¡œê·¸ì¸ ê´€ë ¨ ìš”ì†Œ â­ï¸
        const authTitle = document.getElementById('auth-title');
        const loginIdInput = document.getElementById('login-id');
        const loginPwInput = document.getElementById('login-pw');
        // â­ï¸ ì‹ ê·œ: ì„±ëª… í•„ë“œ â­ï¸
        const registerFullNameInput = document.getElementById('register-full-name'); 
        const registerPwConfirmInput = document.getElementById('register-pw-confirm');
        const toggleRegisterBtn = document.getElementById('toggle-register-btn');
        
        const loginBtn = document.getElementById('login-btn');
        const loginSection = document.getElementById('login-section');
        const appContainer = document.getElementById('refrigerator-app'); 
        
        // â­ï¸ ì‹ ê·œ: ë©”ë‰´ íŒì—… ê´€ë ¨ ìš”ì†Œ (ID ìœ ì§€) â­ï¸
        const menuTrigger = document.getElementById('menu-trigger'); // ë©”ë‰´ ë²„íŠ¼ ìš”ì†Œ
        const menuPopup = document.getElementById('menu-popup');
        const menuLogoutButton = document.getElementById('menu-logout');
        const menuRefrigeratorButton = document.getElementById('menu-refrigerator');
        // â­ï¸ ì‹ ê·œ: í™˜ê²½ ì„¤ì • ë²„íŠ¼ â­ï¸
        const menuSettingsButton = document.getElementById('menu-settings');


        // â­ï¸ ì¬ê³  ê´€ë¦¬ ê´€ë ¨ ìš”ì†Œ â­ï¸
        const barcodeInput = document.getElementById('barcode-input');
        const searchButton = document.getElementById('search-button');
        const cameraTrigger = document.getElementById('camera-trigger');
        const cameraInput = document.getElementById('camera-input');
        const productInfoBox = document.getElementById('product-info-box');
        const displayProductName = document.getElementById('display-product-name');
        const displayMajorCategory = document.getElementById('display-major-category');
        const expiryDateInput = document.getElementById('expiry-date-input');
        const registerButton = document.getElementById('register-button');
        const statusMessage = document.getElementById('status-message');
        const loadInventoryButton = document.getElementById('load-inventory-button');
        const inventoryCount = document.getElementById('inventory-count');
        const inventoryListContainer = document.getElementById('inventory-list-container');
        const recipeRecommendations = document.getElementById('recipe-recommendations');
        const navRefrigeratorButton = document.getElementById('nav-refrigerator');
        const navRecipesButton = document.getElementById('nav-recipes');
        const navSettingsButton = document.getElementById('nav-settings');

        let isRegisterMode = false; // í˜„ì¬ ëª¨ë“œ ìƒíƒœ (ê¸°ë³¸: ë¡œê·¸ì¸)
        let currentProductData = {}; // í˜„ì¬ ì¡°íšŒëœ ìƒí’ˆ ì •ë³´ ì €ì¥

        // =============================================================
        // â­ï¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ â­ï¸
        // =============================================================

        /** ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ */
        function showStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.className = `message-box status-${type}`;
            statusMessage.classList.remove('hidden');
        }
        
        /** ë ˆì‹œí”¼ ì¹´ë“œ ìƒì„± ë° ë Œë”ë§ */
        function renderRecipes(recipes) {
            recipeRecommendations.innerHTML = '';
            if (recipes.length === 0) {
                recipeRecommendations.innerHTML = '<p class="col-span-2 p-4 text-gray-500 text-center">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. DBì— ë ˆì‹œí”¼ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>';
                return;
            }
            recipes.forEach(recipe => {
                // â­ï¸â­ï¸â­ï¸ ìˆ˜ì •ëœ ë¶€ë¶„: recipe.imageë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. â­ï¸â­ï¸â­ï¸
                const imageUrl = recipe.image || 'https://via.placeholder.com/400x300?text=No+Image'; // ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ ì´ë¯¸ì§€ URL
                
                const recipeHtml = `
                    <a href="${recipe.link}" target="_blank" class="block bg-white border border-gray-200 rounded-xl shadow-lg hover:shadow-xl transition duration-300 overflow-hidden">
                        <div class="w-full relative overflow-hidden" style="padding-top: 75%;">
                            <img src="${imageUrl}" alt="${recipe.title}" class="absolute top-0 left-0 w-full h-full object-cover">
                        </div>
                        <div class="p-3">
                            <p class="text-sm font-semibold text-gray-800 line-clamp-2">${recipe.title}</p>
                        </div>
                    </a>
                `;
                recipeRecommendations.innerHTML += recipeHtml;
            });
        }

        /** ë“±ë¡ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” */
        function checkRegistrationEligibility() {
            const hasProduct = currentProductData.pluCode && currentProductData.productName;
            const hasExpiryDate = expiryDateInput.value.trim() !== '';
            registerButton.disabled = !(hasProduct && hasExpiryDate);
        }

        /** ë‚¨ì€ ìœ í†µê¸°í•œ ì¼ìˆ˜ ê³„ì‚° */
        function calculateDaysRemaining(expiryDateStr) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const expiryDate = new Date(expiryDateStr);
            expiryDate.setHours(0, 0, 0, 0);
            const diffTime = expiryDate.getTime() - today.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        /** ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ… */
        function formatDate(date) {
            if (!date) return 'ë‚ ì§œ ì •ë³´ ì—†ìŒ';
            if (date instanceof Date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            return date.toString();
        }

        // =============================================================
        // â­ï¸ ì¸ì¦ ê¸°ëŠ¥ í•¨ìˆ˜ (ë¡œê·¸ì¸/íšŒì›ê°€ì… ëª¨ë“œ) â­ï¸
        // =============================================================

        /** ë¡œê·¸ì¸ <-> íšŒì›ê°€ì… ëª¨ë“œ ì „í™˜ */
        function toggleAuthMode(toRegister) {
            isRegisterMode = toRegister;
            if (isRegisterMode) {
                authTitle.textContent = 'í˜¼ë°¥ ë§ˆìŠ¤í„° íšŒì›ê°€ì…';
                loginBtn.textContent = 'íšŒì›ê°€ì…';
                toggleRegisterBtn.textContent = 'ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°';
                registerFullNameInput.classList.remove('hidden');
                registerPwConfirmInput.classList.remove('hidden');
            } else {
                authTitle.textContent = 'í˜¼ë°¥ ë§ˆìŠ¤í„° ë¡œê·¸ì¸';
                loginBtn.textContent = 'ë¡œê·¸ì¸';
                toggleRegisterBtn.textContent = 'íšŒì›ê°€ì…';
                registerFullNameInput.classList.add('hidden');
                registerPwConfirmInput.classList.add('hidden');
            }
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            loginIdInput.value = '';
            loginPwInput.value = '';
            registerFullNameInput.value = '';
            registerPwConfirmInput.value = '';
        }

        /** ë¡œê·¸ì¸ ì²˜ë¦¬ í•¨ìˆ˜ */
        async function handleLogin() {
            const id = loginIdInput.value.trim();
            const password = loginPwInput.value.trim();

            if (!id || !password) {
                alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            loginBtn.disabled = true;
            loginBtn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';

            try {
                // â­ï¸ ì‹¤ì œ API í˜¸ì¶œ ì½”ë“œê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ë”ë¯¸ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤. â­ï¸
                const response = await fetch(`${BASE_URL}/api/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id, password })
                });

                const result = await response.json();

                if (response.ok) {
                    const fullName = result.full_name || 'ì‚¬ìš©ì'; 
                    alert(`ë¡œê·¸ì¸ ì„±ê³µ! ${fullName}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.`);
                    loginSection.style.display = 'none';
                    if (appContainer) { 
                        appContainer.style.display = 'block';
                        // â­ï¸â­ï¸ ìˆ˜ì •/ì¶”ê°€ëœ ë¶€ë¶„ â­ï¸â­ï¸
                        document.getElementById('bottom-nav').style.display = 'flex'; // ë‚´ë¹„ê²Œì´ì…˜ ë°” í‘œì‹œ
                        document.body.style.overflow = 'auto'; 
                        loadInventory(); 
                    }
                } else {
                    alert(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${result.error}`);
                }
            } catch (error) {
                console.error("ë¡œê·¸ì¸ API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                alert("ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'ë¡œê·¸ì¸';
            }
        }

        /** ngrok ì£¼ì†Œ ìë™ íƒìƒ‰ */
        async function getBaseUrl() {
            try {
                const res = await fetch("http://127.0.0.1:4040/api/tunnels");
                const data = await res.json();
                // ì²« ë²ˆì§¸ tunnelì˜ public_url ì‚¬ìš©
                const url = data.tunnels[0].public_url;
                console.log("í˜„ì¬ ngrok ì£¼ì†Œ:", url);
                return url;
            } catch (e) {
                console.error("ngrok ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:", e);
                alert("ngrokì´ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!");
                return null;
            }
        }

        /** íšŒì›ê°€ì… ì²˜ë¦¬ í•¨ìˆ˜ (ì„±ëª… í•„ë“œ ì¶”ê°€ë¨) */
        async function handleRegistration() {
            const id = loginIdInput.value.trim();
            const password = loginPwInput.value.trim();
            const passwordConfirm = registerPwConfirmInput.value.trim();
            const full_name = registerFullNameInput.value.trim(); // â­ï¸ ì„±ëª… ê°’ íšë“ â­ï¸

            if (!id || !password || !passwordConfirm || !full_name) {
                alert('ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸, ì„±ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (password !== passwordConfirm) {
                alert('ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            loginBtn.disabled = true;
            loginBtn.textContent = 'ë“±ë¡ ì¤‘...';

            try {
                // âœ… ìë™ìœ¼ë¡œ ngrok ì£¼ì†Œ ë¶ˆëŸ¬ì˜¤ê¸°
                const BASE_URL = await getBaseUrl();
                if (!BASE_URL) return;

                const response = await fetch(`${BASE_URL}/api/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id, password, full_name })
                });

                const result = await response.json();

                if (response.status === 201) {
                    alert(`íšŒì›ê°€ì… ì„±ê³µ: ${result.message}\nì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.`);
                    toggleAuthMode(false); // ë¡œê·¸ì¸ ëª¨ë“œë¡œ ì „í™˜
                } else {
                    alert(`íšŒì›ê°€ì… ì‹¤íŒ¨: ${result.error}`);
                }
            } catch (error) {
                console.error("íšŒì›ê°€ì… API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                alert("ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'íšŒì›ê°€ì…';
            }
        }


        // =============================================================
        // â­ï¸ ë°”ì½”ë“œ ì¸ì‹ ë° ìƒí’ˆ ì¡°íšŒ (API ì£¼ì†Œ ë° ë°©ì‹ ìˆ˜ì •) â­ï¸
        // =============================================================

        /** ë°”ì½”ë“œ ì´ë¯¸ì§€ ì¸ì‹ API í˜¸ì¶œ */
        async function recognizeBarcode(file) {
            showStatus('ë°”ì½”ë“œë¥¼ ì¸ì‹í•˜ëŠ” ì¤‘...');
            cameraTrigger.disabled = true;

            const formData = new FormData();
            formData.append('image', file);

            try {
                // â­ï¸ URL ì¼ì¹˜: /api/recognize-barcode (app.pyì™€ ì¼ì¹˜) â­ï¸
                const response = await fetch(`${BASE_URL}/api/recognize-barcode`, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (response.ok) {
                    showStatus(`ë°”ì½”ë“œ ì¸ì‹ ì„±ê³µ: ${result.pluCode}`, 'success');
                    barcodeInput.value = result.pluCode;
                    searchProduct(result.pluCode);
                } else {
                    showStatus(`ë°”ì½”ë“œ ì¸ì‹ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error("ë°”ì½”ë“œ API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                showStatus("ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Flask ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.", 'error');
            } finally {
                cameraTrigger.disabled = false;
            }
        }

        /** ìƒí’ˆ ì •ë³´ ì¡°íšŒ API í˜¸ì¶œ (URL ë° ë°©ì‹ ìˆ˜ì •) */
        async function searchProduct(pluCode) {
            if (!pluCode) {
                showStatus("PLU/ë°”ì½”ë“œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'error');
                return;
            }

            showStatus("ìƒí’ˆ ì •ë³´ ì¡°íšŒ ì¤‘...");

            try {
                // â­ï¸ ìˆ˜ì •ë¨: URLì„ /api/search-pluë¡œ, methodë¥¼ POSTë¡œ ë³€ê²½ â­ï¸
                const response = await fetch(`${BASE_URL}/api/search-plu`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ plu: pluCode }) // app.pyì˜ search_plu í•¨ìˆ˜ëŠ” 'plu' í‚¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
                });
                
                const result = await response.json();

                if (response.ok) {
                    currentProductData = {
                        pluCode: pluCode,
                        productName: result.productName,
                        majorCategory: result.majorCategory
                        // minorCategoryëŠ” ë°±ì—”ë“œì—ì„œ ë°˜í™˜ë˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” í•„ìˆ˜ê°€ ì•„ë‹ˆë¯€ë¡œ ë¬´ì‹œ
                    };
                    displayProductName.textContent = result.productName;
                    displayMajorCategory.textContent = result.majorCategory;
                    productInfoBox.classList.remove('hidden');
                    showStatus(`ìƒí’ˆëª…: ${result.productName} (ëŒ€ë¶„ë¥˜: ${result.majorCategory})`, 'success');
                    checkRegistrationEligibility(); // ìƒí’ˆ ì •ë³´ íšë“ í›„ ë“±ë¡ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
                } else {
                    productInfoBox.classList.add('hidden');
                    currentProductData = {};
                    registerButton.disabled = true;
                    showStatus(`ìƒí’ˆ ì¡°íšŒ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error("ìƒí’ˆ ì¡°íšŒ API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                showStatus("ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Flask ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.", 'error');
            }
        }

        // =============================================================
        // â­ï¸ ì¬ê³  ë“±ë¡ ë° ì¡°íšŒ (URL ìˆ˜ì •) â­ï¸
        // =============================================================

        /** ì¬ê³  ì •ë³´ ë“±ë¡ */
        async function registerInventory() {
            if (registerButton.disabled) return;
            
            const expiryDate = expiryDateInput.value.trim();
            if (!expiryDate) {
                showStatus("ìœ í†µê¸°í•œì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'error');
                return;
            }

            registerButton.disabled = true;
            registerButton.textContent = 'ë“±ë¡ ì¤‘...';
            
            const registrationData = {
                ...currentProductData,
                expiryDate: expiryDate
            };

            try {
                // â­ï¸ URL ì¼ì¹˜: /api/register-inventory (app.pyì™€ ì¼ì¹˜) â­ï¸
                const response = await fetch(`${BASE_URL}/api/register-inventory`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(registrationData)
                });

                const result = await response.json();

                if (response.ok) {
                    showStatus(result.message, 'success');
                    // ì„±ê³µ í›„ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    barcodeInput.value = '';
                    expiryDateInput.value = '';
                    productInfoBox.classList.add('hidden');
                    currentProductData = {};
                    registerButton.disabled = true;
                    loadInventory();
                } else {
                    showStatus(`ë“±ë¡ ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜.'}`, 'error');
                }
            } catch (error) {
                console.error("ë“±ë¡ API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                showStatus("ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Flask ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.", 'error');
            } finally {
                registerButton.disabled = false;
                registerButton.textContent = 'ëƒ‰ì¥ê³ ì— ë“±ë¡í•˜ê¸°';
            }
        }

        /** ì¬ê³  ëª©ë¡ ì¡°íšŒ (URL ìˆ˜ì •) */
        async function loadInventory() {
            showStatus("ëƒ‰ì¥ê³  ì¬ê³  ì •ë³´ë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...", 'info');
            loadInventoryButton.disabled = true;

            try {
                // â­ï¸ ìˆ˜ì •ë¨: URLì„ /api/get-inventoryë¡œ ë³€ê²½ (app.pyì™€ ì¼ì¹˜) â­ï¸
                const response = await fetch(`${BASE_URL}/api/get-inventory`);
                const result = await response.json();

                if (response.ok) {
                    showStatus("ì¬ê³  ëª©ë¡ ì¡°íšŒ ì„±ê³µ!", 'success');
                    renderInventory(result.inventory);
                } else {
                    showStatus(`ì¬ê³  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${result.error}`, 'error');
                    renderInventory([]);
                }
            } catch (error) {
                console.error("ì¬ê³  ì¡°íšŒ API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                showStatus("ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Flask ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.", 'error');
                renderInventory([]);
            } finally {
                loadInventoryButton.disabled = false;
            }
        }

        /** ì¬ê³  ëª©ë¡ ë Œë”ë§ */
        function renderInventory(inventory) {
            inventoryListContainer.innerHTML = '';
            inventoryCount.textContent = inventory.length;

            if (inventory.length === 0) {
                inventoryListContainer.innerHTML = '<p id="no-inventory-message" class="p-4 text-gray-500 text-center">í˜„ì¬ ëƒ‰ì¥ê³ ì— ë“±ë¡ëœ ì¬ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            // 1. ì¬ê³ ë¥¼ ëŒ€ë¶„ë¥˜(majorCategory) ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í™”
            const groupedInventory = inventory.reduce((acc, item) => {
                const category = item.majorCategory || 'ë¯¸ë¶„ë¥˜';
                if (!acc[category]) {
                    acc[category] = [];
                }
                acc[category].push(item);
                return acc;
            }, {});

            let allHtml = '';

            // 2. ê·¸ë£¹ë³„ë¡œ HTML ìƒì„±
            for (const category in groupedInventory) {
                allHtml += `
                    <div class="category-group">
                        <div class="category-header flex justify-between items-center p-4 cursor-pointer bg-gray-100/50">
                            <h3 class="text-lg font-bold text-gray-700">${category} (${groupedInventory[category].length})</h3>
                            <i class="fas fa-chevron-right toggle-icon rotate-90 text-gray-500"></i>
                        </div>
                        <div class="category-items hidden">
                `;

                groupedInventory[category].forEach(item => {
                    const daysRemaining = calculateDaysRemaining(item.expiryDate);
                    let expiryText = '';
                    let itemClass = 'inventory-item';

                    if (daysRemaining < 0) {
                        expiryText = `ë§Œë£Œë¨ (${Math.abs(daysRemaining)}ì¼ ì „)`;
                        itemClass += ' expired';
                    } else if (daysRemaining <= 7) {
                        expiryText = `D-${daysRemaining}`;
                        itemClass += ' expiry-soon';
                    } else {
                        expiryText = `D-${daysRemaining}`;
                    }
                    
                    const itemHtml = `
                        <div class="${itemClass}" data-plu="${item.pluCode}" data-name="${item.productName}">
                            <div>
                                <p class="text-base font-semibold text-gray-800">${item.productName}</p>
                                <p class="text-sm text-gray-500 mt-0.5">ìœ í†µê¸°í•œ: ${formatDate(item.expiryDate)}</p>
                            </div>
                            <div class="flex flex-col items-end">
                                <span class="text-sm font-bold ${daysRemaining < 0 ? 'text-red-600' : daysRemaining <= 7 ? 'text-yellow-600' : 'text-green-600'}">
                                    ${expiryText}
                                </span>
                                <button data-id="${item.inventoryId}" class="delete-button text-red-500 hover:text-red-700 text-sm mt-1">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    allHtml += itemHtml;
                });
                allHtml += `</div>`; // .category-items ë‹«ê¸°
            }
            inventoryListContainer.innerHTML = allHtml;

            // 3. ì¬ê³  í•­ëª© í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë ˆì‹œí”¼ ì¡°íšŒ ê¸°ëŠ¥)
            document.querySelectorAll('.inventory-item').forEach(itemElement => {
                itemElement.addEventListener('click', (e) => {
                    const pluCode = itemElement.getAttribute('data-plu');
                    const productName = itemElement.getAttribute('data-name');
                    searchRecipes(pluCode, productName);
                });
            });

            // 4. ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€ í¬í•¨)
            document.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); // ìƒìœ„ ìš”ì†Œ(inventory-item)ì˜ í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
                    const id = e.currentTarget.getAttribute('data-id');
                    if (confirm(`ì •ë§ ID ${id} ì¬ê³ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        deleteInventoryItem(id);
                    }
                });
            });

            // 5. â­ï¸ ì¹´í…Œê³ ë¦¬ í—¤ë” í† ê¸€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ â­ï¸
            document.querySelectorAll('.category-header').forEach(header => {
                header.addEventListener('click', () => {
                    const targetElement = header.nextElementSibling;
                    const icon = header.querySelector('.toggle-icon');
                    if (targetElement.classList.contains('hidden')) {
                        targetElement.classList.remove('hidden');
                        icon.classList.add('rotate-90');
                    } else {
                        targetElement.classList.add('hidden');
                        icon.classList.remove('rotate-90');
                    }
                });
            });
        }

        /** ì¬ê³  í•­ëª© ì‚­ì œ */
        async function deleteInventoryItem(inventoryId) {
            showStatus(`ì¬ê³  í•­ëª© ID ${inventoryId} ì‚­ì œ ì¤‘...`, 'info');
            try {
                // â­ï¸ URL ì¼ì¹˜: /api/delete-inventory/<int:inventory_id> (app.pyì™€ ì¼ì¹˜) â­ï¸
                const response = await fetch(`${BASE_URL}/api/delete-inventory/${inventoryId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();

                if (response.ok) {
                    showStatus(result.message, 'success');
                    loadInventory(); // ì‚­ì œ í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    showStatus(`ì‚­ì œ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error("ì‚­ì œ API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                showStatus("ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Flask ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.", 'error');
            }
        }
        
        // =============================================================
        // â­ï¸ ë ˆì‹œí”¼ ê²€ìƒ‰ ê¸°ëŠ¥ (ë°©ì‹ ìˆ˜ì •) â­ï¸
        // =============================================================

        /** ë ˆì‹œí”¼ ê²€ìƒ‰ (PLU ì½”ë“œ ê¸°ë°˜) (ë°©ì‹ ìˆ˜ì •) */
        async function searchRecipes(pluCode, productName) {
            if (!pluCode) return;
            
            showStatus(`"${productName}"ë¥¼ í¬í•¨í•˜ëŠ” ë ˆì‹œí”¼ë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...`, 'info');
            
            try {
                // â­ï¸ ìˆ˜ì •ë¨: methodë¥¼ POSTë¡œ ë³€ê²½í•˜ê³  JSON bodyì— pluCodeë¥¼ ë‹´ì•„ ì „ì†¡ â­ï¸
                const response = await fetch(`${BASE_URL}/api/search-recipes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pluCode: pluCode }) // app.pyì˜ search_recipes í•¨ìˆ˜ëŠ” 'pluCode' í‚¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
                });
                
                const result = await response.json();

                if (response.ok) {
                    showStatus(`"${productName}" ê´€ë ¨ ë ˆì‹œí”¼ ${result.recipes.length}ê±´ ì¡°íšŒ ì„±ê³µ.`, 'success');
                    renderRecipes(result.recipes);
                } else {
                    showStatus(`ë ˆì‹œí”¼ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ: ${result.error}`, 'error');
                    renderRecipes([]);
                }
            } catch (error) {
                console.error("ë ˆì‹œí”¼ ê²€ìƒ‰ API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                showStatus("ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Flask ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.", 'error');
                recipeRecommendations.innerHTML = '<p class="col-span-2 p-4 text-center text-red-500">ì„œë²„ ì—°ê²° ì˜¤ë¥˜. ì½˜ì†” í™•ì¸ ìš”ë§.</p>';
            }
        }


        // =============================================================
        // â­ï¸ ê¸°íƒ€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€ ë° ë©”ë‰´ ê¸°ëŠ¥ ë³´ì¡´) â­ï¸
        // =============================================================
        
        // 1. "ìƒí’ˆ ì •ë³´ ì¡°íšŒ" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        searchButton.addEventListener('click', () => {
            const pluCode = barcodeInput.value.trim();
            searchProduct(pluCode);
        });

        // 2. ë°”ì½”ë“œ ì…ë ¥ í•„ë“œì—ì„œ Enter í‚¤ ì…ë ¥ ì´ë²¤íŠ¸
        barcodeInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                searchButton.click();
            }
        });

        // 3. ìœ í†µê¸°í•œ ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ ë“±ë¡ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        expiryDateInput.addEventListener('change', checkRegistrationEligibility);

        // 4. "ëƒ‰ì¥ê³ ì— ë“±ë¡í•˜ê¸°" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        registerButton.addEventListener('click', registerInventory);

        // 5. "ë‚˜ì˜ ëƒ‰ì¥ê³  ì¡°íšŒ" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        loadInventoryButton.addEventListener('click', loadInventory);

        // 6. ì¹´ë©”ë¼ íŠ¸ë¦¬ê±° ë²„íŠ¼ í´ë¦­ (Hidden File Input í´ë¦­)
        cameraTrigger.addEventListener('click', () => {
            cameraInput.click();
        });

        // 7. ì¹´ë©”ë¼ ì…ë ¥(ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ) ë³€ê²½ ì´ë²¤íŠ¸
        cameraInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                recognizeBarcode(file);
            }
        });

        // 8. â­ï¸ ë©”ë‰´ ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (íŒì—… í† ê¸€) â­ï¸ (ê¸°ì¡´ ê¸°ëŠ¥ ë³´ì¡´)
        menuTrigger.addEventListener('click', (e) => {
            e.stopPropagation(); // ë¬¸ì„œ í´ë¦­ ì´ë²¤íŠ¸ë¡œ ë‹«íˆëŠ” ê²ƒì„ ë°©ì§€
            menuPopup.classList.toggle('hidden');
        });

        // 9. â­ï¸ ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ íŒì—… ë‹«ê¸° â­ï¸ (ê¸°ì¡´ ê¸°ëŠ¥ ë³´ì¡´)
        document.addEventListener('click', (e) => {
            // íŒì—…ì´ ì—´ë ¤ìˆê³ , í´ë¦­ëœ ìš”ì†Œê°€ íŒì—… ë‚´ë¶€ë„, ë²„íŠ¼ë„ ì•„ë‹ ë•Œ íŒì—… ë‹«ê¸°
            if (!menuPopup.classList.contains('hidden') && !menuPopup.contains(e.target) && e.target !== menuTrigger) {
                menuPopup.classList.add('hidden');
            }
        });
        
        // 10. â­ï¸ 'ë¡œê·¸ì•„ì›ƒ' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (íŒì—… ë‚´ë¶€) â­ï¸ (ê¸°ì¡´ ê¸°ëŠ¥ ë³´ì¡´)
        menuLogoutButton.addEventListener('click', () => {
            menuPopup.classList.add('hidden'); // ë©”ë‰´ ë‹«ê¸°
            if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { 
                isRegisterMode = false;
                toggleAuthMode(false);
                
                if (appContainer) {
                    appContainer.style.display = 'none'; 
                }
                loginSection.style.display = 'flex'; 
                document.body.style.overflow = 'hidden'; 
                
                alert("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        });

        // 11. â­ï¸ 'ì¬ë£Œ ìœ í†µê¸°í•œ ê´€ë¦¬' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (íŒì—… ë‚´ë¶€) â­ï¸ (ê¸°ì¡´ ê¸°ëŠ¥ ë³´ì¡´)
        menuRefrigeratorButton.addEventListener('click', () => {
             menuPopup.classList.add('hidden'); // ë©”ë‰´ ë‹«ê¸°
             // í˜„ì¬ í˜ì´ì§€ì´ë¯€ë¡œ íŒì—…ë§Œ ë‹«ìŒ
        });

        // 12. â­ï¸ 'í™˜ê²½ ì„¤ì •' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ì‹ ê·œ ì¶”ê°€) â­ï¸
        if (menuSettingsButton) {
            menuSettingsButton.addEventListener('click', () => {
                menuPopup.classList.add('hidden'); // ë©”ë‰´ ë‹«ê¸°
                showStatus("í™˜ê²½ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•  ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...", 'info');
            });
        }

        // ë¡œê·¸ì¸ <-> íšŒì›ê°€ì… í† ê¸€ ë²„íŠ¼ ì´ë²¤íŠ¸
        toggleRegisterBtn.addEventListener('click', (e) => {
            e.preventDefault();
            toggleAuthMode(!isRegisterMode);
        });

        // ìµœì¢… ì¸ì¦ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ë¡œê·¸ì¸/íšŒì›ê°€ì… ë¶„ê¸°)
        loginBtn.addEventListener('click', () => {
            if (isRegisterMode) {
                handleRegistration();
            } else {
                handleLogin();
            }
        });

        // 14. â­ï¸â­ï¸ ì‹ ê·œ: í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜ ë°” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ â­ï¸â­ï¸
        if (navRefrigeratorButton) {
            // 14-1. ì¬ê³  ê´€ë¦¬ ë²„íŠ¼ -> 'ë‚˜ì˜ ëƒ‰ì¥ê³ ' í™ˆ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ìˆ˜ì •
            navRefrigeratorButton.addEventListener('click', () => {
                // ğŸš¨ ìˆ˜ì •: ì‹¤ì œ 'ë‚˜ì˜ ëƒ‰ì¥ê³ ' í™ˆ ê²½ë¡œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
                window.location.href = '/refrigerator.html'; // ì˜ˆì‹œ ê²½ë¡œ
                // ë˜ëŠ” ë©”ì¸ í˜ì´ì§€ë¼ë©´: window.location.href = '/'; 
            });
        }

        if (navRecipesButton) {
            // 14-2. ë ˆì‹œí”¼ ì¶”ì²œ ë²„íŠ¼ (ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ìˆ˜ì •)
            navRecipesButton.addEventListener('click', () => {
                // â­ï¸â­ï¸ ìˆ˜ì •: 'recipes.html' í˜ì´ì§€ë¡œ ì™„ì „íˆ ì´ë™í•˜ë„ë¡ ë³€ê²½ â­ï¸â­ï¸
                window.location.href = '/weather_recipes'; 
            });
        }

        // 14-3. í™˜ê²½ ì„¤ì • ë²„íŠ¼ (ê¸°ëŠ¥ ì‹¤í–‰)
        if (navSettingsButton) {
            navSettingsButton.addEventListener('click', () => {
                showStatus("í™˜ê²½ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•  ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...", 'info');
        });
        }
    </script>
</body>
</html>